{"remainingRequest":"/Users/hyamakawa/VSCodeWork/Modern-T/Modern-T/study_template/web_application/node_modules/thread-loader/dist/cjs.js!/Users/hyamakawa/VSCodeWork/Modern-T/Modern-T/study_template/web_application/node_modules/babel-loader/lib/index.js??ref--5!/Users/hyamakawa/VSCodeWork/Modern-T/Modern-T/study_template/web_application/server/util/EsmRdb.js","dependencies":[{"path":"/Users/hyamakawa/VSCodeWork/Modern-T/Modern-T/study_template/web_application/server/util/EsmRdb.js","mtime":1657404556450},{"path":"/Users/hyamakawa/VSCodeWork/Modern-T/Modern-T/study_template/web_application/server/.babelrc","mtime":1657404556444},{"path":"/Users/hyamakawa/VSCodeWork/Modern-T/Modern-T/study_template/web_application/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hyamakawa/VSCodeWork/Modern-T/Modern-T/study_template/web_application/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hyamakawa/VSCodeWork/Modern-T/Modern-T/study_template/web_application/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvciI7CmltcG9ydCBfdHlwZW9mIGZyb20gIi9Vc2Vycy9oeWFtYWthd2EvVlNDb2RlV29yay9Nb2Rlcm4tVC9Nb2Rlcm4tVC9zdHVkeV90ZW1wbGF0ZS93ZWJfYXBwbGljYXRpb24vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3R5cGVvZiI7CmV4cG9ydCBmdW5jdGlvbiBFc21SZGIoKSB7CiAgcmV0dXJuIG5ldyBSZGJJbnN0YW5jZShzZXR0aW5ncyk7Cn0gLy8gU2NyaXB0RGJJbnN0YW5jZeOCguOBqeOBjQoKZnVuY3Rpb24gUmRiSW5zdGFuY2UoY29uZmlnKSB7CiAgdmFyIF90aGlzID0gdGhpczsKCiAgdGhpcy5BU0NFTkRJTkcgPSAwOwogIHRoaXMuREVTQ0VORElORyA9IDE7CiAgU1EucmVnaXN0ZXJWYWx1ZUhhbmRsZXIoRGF0ZSwgZnVuY3Rpb24gKGRhdGUpIHsKICAgIC8vICAgIHJldHVybiAnIicgKyBkYXRlLmdldEZ1bGxZZWFyKCkgKyAnLScgKyAoZGF0ZS5nZXRNb250aCgpKzEpICsgJy0nICsgZGF0ZS5nZXREYXRlKCkgKyAnIic7CiAgICByZXR1cm4gIiciICsgVXRpbGl0aWVzLmZvcm1hdERhdGUoZGF0ZSwgJ0pTVCcsICd5eXl5LU1NLWRkIEhIOm1tOnNzJykgKyAiJyI7CiAgfSk7CiAgdGhpcy5hZGRyZXNzID0gY29uZmlnLmRiQWRkcmVzcyB8fCAnMzQuODQuMjU0LjEwOCc7CiAgdGhpcy5teXNxbFVzZXIgPSBjb25maWcudXNlciB8fCAndXNlcic7CiAgdGhpcy5teXNxbFB3ZCA9IGNvbmZpZy5wd2QgfHwgJ2hvZ2U5OSc7CiAgdGhpcy5kYiA9IGNvbmZpZy5kYiB8fCAnYnBtJzsKICB0aGlzLmluc3RhbmNlVXJsID0gJ2pkYmM6Z29vZ2xlOm15c3FsOi8vJyArIHRoaXMuYWRkcmVzczsKICB0aGlzLmRiVXJsID0gdGhpcy5pbnN0YW5jZVVybCArICcvJyArIHRoaXMuZGI7CiAgdGhpcy5hdXRvQ29tbWl0ID0gdHlwZW9mIGNvbmZpZy5hdXRvQ29tbWl0ID09PSAndW5kZWZpbmVkJyA/IHRydWUgOiBjb25maWcuYXV0b0NvbW1pdDsKICB0aGlzLmRlYnVnU2hlZXQgPSBjb25maWcuZGVidWdTaGVldElkID8gU3ByZWFkc2hlZXRBcHAub3BlbkJ5SWQoY29uZmlnLmRlYnVnU2hlZXRJZCkuZ2V0U2hlZXRCeU5hbWUoJ2RlYnVnJykgOiBudWxsOwogIHRoaXMubm9uRXhlY3V0ZSA9IGNvbmZpZy5ub25FeGVjdXRlIHx8IGZhbHNlOwogIHRoaXMuZGVidWdVcGRhdGVPbmx5ID0gY29uZmlnLmRlYnVnVXBkYXRlT25seSB8fCBmYWxzZTsKICB0aGlzLmNvbm4gPSBKZGJjLmdldENsb3VkU3FsQ29ubmVjdGlvbih0aGlzLmRiVXJsLCB0aGlzLm15c3FsVXNlciwgdGhpcy5teXNxbFB3ZCk7CiAgdGhpcy5jb25uLnNldEF1dG9Db21taXQodGhpcy5hdXRvQ29tbWl0KTsKCiAgdGhpcy5kZWJ1ZyA9IGZ1bmN0aW9uIChzdHIpIHsKICAgIGlmICh0aGlzLmRlYnVnU2hlZXQpIHsKICAgICAgdGhpcy5kZWJ1Z1NoZWV0LmFwcGVuZFJvdyhbc3RyICsgJzsnXSk7CiAgICB9IGVsc2UgewogICAgICBMb2dnZXIubG9nKHN0cik7CiAgICB9CiAgfTsgLy8gYXV0b0NvbW1pdOOBruioreWumgoKCiAgdGhpcy5zZXRBdXRvQ29tbWl0ID0gZnVuY3Rpb24gKGF1dG9Db21taXQpIHsKICAgIF90aGlzLmF1dG9Db21taXQgPSBhdXRvQ29tbWl0OwoKICAgIF90aGlzLmNvbm4uc2V0QXV0b0NvbW1pdChfdGhpcy5hdXRvQ29tbWl0KTsKICB9OwoKICB0aGlzLmNyZWF0ZVRhYmxlQnlTaGVldCA9IGZ1bmN0aW9uIChzaGVldElkLCBzaGVldE5hbWUsIGRyb3BUYWJsZSwgY29weURhdGEpIHsKICAgIHRoaXMuYXV0b0NvbW1pdCA9IGZhbHNlOwogICAgdGhpcy5jb25uLnNldEF1dG9Db21taXQodGhpcy5hdXRvQ29tbWl0KTsKICAgIHZhciBzcyA9IFNwcmVhZHNoZWV0QXBwLm9wZW5CeUlkKHNoZWV0SWQpOwogICAgdmFyIHNoZWV0ID0gc3MuZ2V0U2hlZXRCeU5hbWUoc2hlZXROYW1lKTsKICAgIHZhciBkZGwgPSAnQ1JFQVRFIFRBQkxFICcgKyBzaGVldE5hbWUgKyAnICgnOwogICAgdmFyIHJhbmdlID0gc2hlZXQuZ2V0RGF0YVJhbmdlKCk7CiAgICB2YXIgdmFsdWVzID0gcmFuZ2UuZ2V0VmFsdWVzKCk7CiAgICB2YXIgaGVhZGVycyA9IHZhbHVlc1swXTsgLy8g5YWI6aCt44GM44Kr44Op44Og5ZCN44GM5YmN5o+QCgogICAgdmFyIGNvbERlZnMgPSBbXTsKICAgIHZhciBrZXlDb2wgPSAnJzsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhlYWRlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGNvbE5hbWUgPSBoZWFkZXJzW2ldOwogICAgICBpZiAoaSA9PSAwKSBrZXlDb2wgPSBjb2xOYW1lOwogICAgICB2YXIgY29sVHlwZSA9IHNoZWV0LmdldFJhbmdlKDEsIGkgKyAxKS5nZXROb3RlKCk7CiAgICAgIGNvbERlZnMucHVzaChjb2xOYW1lICsgJyAnICsgY29sVHlwZSk7CiAgICB9CgogICAgZGRsICs9IGNvbERlZnMuam9pbignLCcpOwogICAgZGRsICs9ICcsUFJJTUFSWSBLRVkoJyArIGtleUNvbCArICcpJzsKICAgIGRkbCArPSAnKTsnOwogICAgdGhpcy5kZWJ1ZyhkZGwpOwoKICAgIHRyeSB7CiAgICAgIGlmIChkcm9wVGFibGUpIHsKICAgICAgICB0aGlzLmNvbm4uY3JlYXRlU3RhdGVtZW50KCkuZXhlY3V0ZSgnZHJvcCB0YWJsZSAnICsgc2hlZXROYW1lKTsKICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICB0aGlzLmRlYnVnKCdkcm9wIHRhYmxl5aSx5pWX77yI54Sh6KaW77yJJyk7CiAgICB9CgogICAgdGhpcy5jb25uLmNyZWF0ZVN0YXRlbWVudCgpLmV4ZWN1dGUoZGRsKTsKCiAgICBpZiAoY29weURhdGEpIHsKICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgcm93ID0gdmFsdWVzW2ldOwogICAgICAgIHZhciBpdGVtID0ge307CiAgICAgICAgaXRlbS50eXBlID0gc2hlZXROYW1lOwoKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHJvdy5sZW5ndGg7IGorKykgewogICAgICAgICAgaXRlbVtoZWFkZXJzW2pdXSA9IHJvd1tqXTsKICAgICAgICB9CgogICAgICAgIHRoaXMuZGVidWcoaXRlbSk7CiAgICAgICAgdGhpcy5pbnNlcnQoaXRlbSwgewogICAgICAgICAgYXV0b0lkOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgdGhpcy5jbG9zZSgpOwogIH07CgogIHZhciBBbnlPZiA9IGZ1bmN0aW9uIEFueU9mKHZhbHVlcykgewogICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXM7CgogICAgdGhpcy5idWlsZFdoZXJlID0gZnVuY3Rpb24gKHNxbCwgcHJvcE5hbWUsIHByb3BWYWx1ZSkgewogICAgICBzcWwud2hlcmUocHJvcE5hbWUgKyAnIGluID8nLCB0aGlzLnZhbHVlcyk7CiAgICAgIHJldHVybiBzcWw7CiAgICB9OwogIH07CgogIHRoaXMuYW55T2YgPSBmdW5jdGlvbiAodmFsdWVzKSB7CiAgICByZXR1cm4gbmV3IEFueU9mKHZhbHVlcyk7CiAgfTsKCiAgdmFyIE5vdCA9IGZ1bmN0aW9uIE5vdCh2YWx1ZSkgewogICAgdGhpcy52YWx1ZSA9IHZhbHVlOwoKICAgIHRoaXMuYnVpbGRXaGVyZSA9IGZ1bmN0aW9uIChzcWwsIHByb3BOYW1lLCBwcm9wVmFsdWUpIHsKICAgICAgdmFyIHR5cGUgPSBfdHlwZW9mKHRoaXMudmFsdWUpOwoKICAgICAgaWYgKHR5cGUgPT0gJ3N0cmluZycpIHsKICAgICAgICBzcWwud2hlcmUocHJvcE5hbWUgKyAiICE9ICciICsgdGhpcy52YWx1ZSArICInIik7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAnbnVtYmVyJykgewogICAgICAgIHNxbC53aGVyZShwcm9wTmFtZSArICcgIT0gJyArIHRoaXMudmFsdWUgKyAnJyk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAnYm9vbGVhbicpIHsKICAgICAgICB2YXIgYm9vbCA9IHRoaXMudmFsdWUgPT0gdHJ1ZSA/IDEgOiAwOwogICAgICAgIHNxbC53aGVyZShwcm9wTmFtZSArICIgIT0gJyIgKyBib29sICsgIiciKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHNxbDsKICAgIH07CiAgfTsKCiAgdGhpcy5ub3QgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgIHJldHVybiBuZXcgTm90KHZhbHVlKTsKICB9OwoKICB2YXIgR3JlYXRlclRoYW5PckVxdWFsVG8gPSBmdW5jdGlvbiBHcmVhdGVyVGhhbk9yRXF1YWxUbyh2YWx1ZSkgewogICAgdGhpcy52YWx1ZSA9IHZhbHVlOwoKICAgIHRoaXMuYnVpbGRXaGVyZSA9IGZ1bmN0aW9uIChzcWwsIHByb3BOYW1lLCBwcm9wVmFsdWUpIHsKICAgICAgc3FsLndoZXJlKHByb3BOYW1lICsgJyA+PSA/JywgdGhpcy52YWx1ZSk7CiAgICAgIHJldHVybiBzcWw7CiAgICB9OwogIH07CgogIHRoaXMuZ3JlYXRlclRoYW5PckVxdWFsVG8gPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgIHJldHVybiBuZXcgR3JlYXRlclRoYW5PckVxdWFsVG8odmFsdWUpOwogIH07CgogIHZhciBMZXNzVGhhbk9yRXF1YWxUbyA9IGZ1bmN0aW9uIExlc3NUaGFuT3JFcXVhbFRvKHZhbHVlKSB7CiAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgogICAgdGhpcy5idWlsZFdoZXJlID0gZnVuY3Rpb24gKHNxbCwgcHJvcE5hbWUsIHByb3BWYWx1ZSkgewogICAgICBzcWwud2hlcmUocHJvcE5hbWUgKyAnIDw9ID8nLCB0aGlzLnZhbHVlKTsKICAgICAgcmV0dXJuIHNxbDsKICAgIH07CiAgfTsKCiAgdGhpcy5sZXNzVGhhbk9yRXF1YWxUbyA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgcmV0dXJuIG5ldyBMZXNzVGhhbk9yRXF1YWxUbyh2YWx1ZSk7CiAgfTsKCiAgdmFyIEdyZWF0ZXJUaGFuID0gZnVuY3Rpb24gR3JlYXRlclRoYW4odmFsdWUpIHsKICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKCiAgICB0aGlzLmJ1aWxkV2hlcmUgPSBmdW5jdGlvbiAoc3FsLCBwcm9wTmFtZSwgcHJvcFZhbHVlKSB7CiAgICAgIHNxbC53aGVyZShwcm9wTmFtZSArICcgPiA/JywgdGhpcy52YWx1ZSk7CiAgICAgIHJldHVybiBzcWw7CiAgICB9OwogIH07CgogIHRoaXMuZ3JlYXRlclRoYW4gPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgIHJldHVybiBuZXcgR3JlYXRlclRoYW4odmFsdWUpOwogIH07CgogIHZhciBMZXNzVGhhbiA9IGZ1bmN0aW9uIExlc3NUaGFuKHZhbHVlKSB7CiAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgogICAgdGhpcy5idWlsZFdoZXJlID0gZnVuY3Rpb24gKHNxbCwgcHJvcE5hbWUsIHByb3BWYWx1ZSkgewogICAgICBzcWwud2hlcmUocHJvcE5hbWUgKyAnIDwgPycsIHRoaXMudmFsdWUpOwogICAgICByZXR1cm4gc3FsOwogICAgfTsKICB9OwoKICB0aGlzLmxlc3NUaGFuID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICByZXR1cm4gbmV3IExlc3NUaGFuKHZhbHVlKTsKICB9OwoKICB2YXIgQmV0d2VlbiA9IGZ1bmN0aW9uIEJldHdlZW4odmFsdWUxLCB2YWx1ZTIpIHsKICAgIHRoaXMudmFsdWUxID0gdmFsdWUxOwogICAgdGhpcy52YWx1ZTIgPSB2YWx1ZTI7CgogICAgdGhpcy5idWlsZFdoZXJlID0gZnVuY3Rpb24gKHNxbCwgcHJvcE5hbWUsIHByb3BWYWx1ZSkgewogICAgICBzcWwud2hlcmUocHJvcE5hbWUgKyAnIGJldHdlZW4gPyBhbmQgPycsIHRoaXMudmFsdWUxLCB0aGlzLnZhbHVlMik7CiAgICAgIHJldHVybiBzcWw7CiAgICB9OwogIH07CgogIHRoaXMuYmV0d2VlbiA9IGZ1bmN0aW9uICh2YWx1ZTEsIHZhbHVlMikgewogICAgcmV0dXJuIG5ldyBCZXR3ZWVuKHZhbHVlMSwgdmFsdWUyKTsKICB9OwoKICB2YXIgQ29udGFpbnMgPSBmdW5jdGlvbiBDb250YWlucyh2YWx1ZSkgewogICAgdGhpcy52YWx1ZSA9IHZhbHVlOwoKICAgIHRoaXMuaGFzVmFsdWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLnZhbHVlICE9ICcnOwogICAgfTsKCiAgICB0aGlzLmJ1aWxkV2hlcmUgPSBmdW5jdGlvbiAoc3FsLCBwcm9wTmFtZSwgcHJvcFZhbHVlKSB7CiAgICAgIHNxbC53aGVyZShwcm9wTmFtZSArICIgbGlrZSAnJSIgKyB0aGlzLnZhbHVlICsgIiUnIik7CiAgICAgIHJldHVybiBzcWw7CiAgICB9OwogIH07CgogIHRoaXMuY29udGFpbnMgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgIHJldHVybiBuZXcgQ29udGFpbnModmFsdWUpOwogIH07CgogIHZhciBJc051bGwgPSBmdW5jdGlvbiBJc051bGwodmFsdWUpIHsKICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKCiAgICB0aGlzLmJ1aWxkV2hlcmUgPSBmdW5jdGlvbiAoc3FsLCBwcm9wTmFtZSwgcHJvcFZhbHVlKSB7CiAgICAgIHNxbC53aGVyZShwcm9wTmFtZSArICcgaXMgTlVMTCcpOwogICAgICByZXR1cm4gc3FsOwogICAgfTsKICB9OwoKICB0aGlzLmlzTnVsbCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgcmV0dXJuIG5ldyBJc051bGwodmFsdWUpOwogIH07IC8vIGluc2VydOODoeOCveODg+ODieOAggoKCiAgdGhpcy5pbnNlcnQgPSBmdW5jdGlvbiAoaXRlbSwgb3B0aW9uKSB7CiAgICBjaGVja05vVHlwZUVycm9yKGl0ZW0udHlwZSk7CiAgICB2YXIgaWRDb2x1bW4gPSBvcHRpb24uaWRDb2x1bW4gfHwgJ19pZF8nOwogICAgdmFyIGF1dG9JZCA9IHR5cGVvZiBvcHRpb24uYXV0b0lkID09PSAndW5kZWZpbmVkJyA/IHRydWUgOiBvcHRpb24uYXV0b0lkOwoKICAgIGlmIChhdXRvSWQpIHsKICAgICAgLy8gaW5zZXJ0IGF1dG8ga2V5CiAgICAgIGl0ZW1baWRDb2x1bW5dID0gZ2VuVVVJRCgpOwogICAgfQoKICAgIHZhciBzcWwgPSB0aGlzLmJ1aWxkSW5zZXJ0KGl0ZW0pOwogICAgdGhpcy5leGVjVXBkYXRlKHNxbCk7CiAgICByZXR1cm4gaXRlbTsKICB9OyAvLyB1cGRhdGXjg6Hjgr3jg4Pjg4njgIIKCgogIHRoaXMudXBkYXRlID0gZnVuY3Rpb24gKGl0ZW0sIG9wdGlvbikgewogICAgY2hlY2tOb1R5cGVFcnJvcihpdGVtLnR5cGUpOwogICAgdmFyIGlkQ29sdW1uID0gJ19pZF8nOwoKICAgIGlmIChvcHRpb24pIHsKICAgICAgaWRDb2x1bW4gPSBvcHRpb24uaWRDb2x1bW47CiAgICB9CgogICAgdmFyIHNxbCA9IHRoaXMuYnVpbGRVcGRhdGUoaXRlbSwgaWRDb2x1bW4pOwogICAgdGhpcy5leGVjVXBkYXRlKHNxbCk7CiAgICByZXR1cm4gaXRlbTsKICB9OyAvLyDjgYLjgozjgbB1cGRhdGXjgIHjgarjgZHjgozjgbBpbnNlcnQKCgogIHRoaXMudXBkYXRlT3JJbnNlcnQgPSBmdW5jdGlvbiAoaXRlbSwgb3B0aW9uKSB7CiAgICBjaGVja05vVHlwZUVycm9yKGl0ZW0udHlwZSk7CiAgICB2YXIgaWRDb2x1bW4gPSAnX2lkXyc7CgogICAgaWYgKG9wdGlvbikgewogICAgICBpZENvbHVtbiA9IG9wdGlvbi5pZENvbHVtbjsKICAgIH0KCiAgICB2YXIgY291bnRTcWwgPSAnc2VsZWN0IGNvdW50KCopIGFzIGNvdW50IGZyb20gJyArIGl0ZW0udHlwZSArICcgd2hlcmUgJyArIGlkQ29sdW1uICsgIiA9ICciICsgaXRlbVtpZENvbHVtbl0gKyAiJyI7CiAgICB2YXIgcmVzdWx0cyA9IHRoaXMuZXhlY1F1ZXJ5Xyhjb3VudFNxbCk7CiAgICBpZiAocmVzdWx0cy5sZW5ndGggPT09IDApIHRocm93IG5ldyBFcnJvcign44Os44Kz44O844OJ44GM5a2Y5Zyo44GX44G+44Gb44KT44CCOicgKyBpdGVtKTsKICAgIHZhciBjb3VudCA9IHJlc3VsdHNbMF0uY291bnQ7CgogICAgaWYgKGNvdW50ID09IDApIHsKICAgICAgLy8gaW5zZXJ0CiAgICAgIHJldHVybiB0aGlzLmluc2VydChpdGVtLCBvcHRpb24pOwogICAgfSBlbHNlIHsKICAgICAgLy8gdXBkYXRlCiAgICAgIHJldHVybiB0aGlzLnVwZGF0ZShpdGVtLCBvcHRpb24pOwogICAgfQogIH07IC8vIHNhdmXkupLmj5vjg6Hjgr3jg4Pjg4njgIIKICAvLyDkupLmj5vmgKfjga7jgZ/jgoHjgIFfaWRf44Kr44Op44Og44GM44OX44Op44Kk44Oe44Oq44O844Kt44O844Go44GX44Gm5a2Y5Zyo44GZ44KL44GT44Go44KS5YmN5o+Q44Go44GZ44KL44CCCgoKICB0aGlzLnNhdmUgPSBmdW5jdGlvbiAoaXRlbSkgewogICAgY2hlY2tOb1R5cGVFcnJvcihpdGVtLnR5cGUpOwogICAgdmFyIGNvbE5hbWUgPSBudWxsOwogICAgdmFyIGNvbFZhbHVlID0gbnVsbDsKCiAgICBmb3IgKHZhciBwcm9wTmFtZSBpbiBpdGVtKSB7CiAgICAgIGlmIChwcm9wTmFtZSA9PSAnX2lkXycpIHsKICAgICAgICBjb2xOYW1lID0gcHJvcE5hbWU7CiAgICAgICAgY29sVmFsdWUgPSBpdGVtW3Byb3BOYW1lXTsKICAgICAgfQogICAgfQoKICAgIGlmICghY29sTmFtZSkgewogICAgICAvLyBpbnNlcnTjg6Ljg7zjg4kKICAgICAgY29sTmFtZSA9ICdfaWRfJzsKICAgIH0KCiAgICB2YXIgc3FsOwogICAgdmFyIHV1aWQgPSBnZW5VVUlEKCk7CgogICAgaWYgKCFjb2xWYWx1ZSkgewogICAgICAvLyBpbnNlcnQgYXV0byBrZXkKICAgICAgaXRlbVtjb2xOYW1lXSA9IHV1aWQ7CiAgICAgIHNxbCA9IHRoaXMuYnVpbGRJbnNlcnQoaXRlbSk7CiAgICB9IGVsc2UgewogICAgICBzcWwgPSB0aGlzLmJ1aWxkVXBkYXRlKGl0ZW0sICdfaWRfJyk7CiAgICB9CgogICAgdGhpcy5leGVjVXBkYXRlKHNxbCk7CiAgICByZXR1cm4gaXRlbTsKICB9OyAvLyByZW1vdmXkupLmj5vjg6Hjgr3jg4Pjg4njgIIKCgogIHRoaXMucmVtb3ZlID0gZnVuY3Rpb24gKGl0ZW0pIHsKICAgIGNoZWNrTm9UeXBlRXJyb3IoaXRlbS50eXBlKTsKICAgIHZhciBzcWwgPSB0aGlzLmJ1aWxkRGVsZXRlKGl0ZW0pOwogICAgcmV0dXJuIHRoaXMuZXhlY1VwZGF0ZShzcWwpOwogIH07IC8vIHF1ZXJ55LqS5o+b44Oh44K944OD44OJ44CCCgoKICB0aGlzLnF1ZXJ5ID0gZnVuY3Rpb24gKHF1ZXJ5LCBmaWVsZHMpIHsKICAgIGNoZWNrTm9UeXBlRXJyb3IocXVlcnkudHlwZSk7CiAgICB2YXIgc3FsID0gdGhpcy5idWlsZFNlbGVjdChxdWVyeSwgZmllbGRzKTsKICAgIHZhciByZXN1bHRzID0gdGhpcy5leGVjUXVlcnkoc3FsKTsKICAgIHJldHVybiBuZXcgUkRiUmVzdWx0KHJlc3VsdHMpOwogIH07CgogIHRoaXMuYnVpbGRTZWxlY3QgPSBmdW5jdGlvbiAocXVlcnksIGZpZWxkcykgewogICAgdmFyIHNxbCA9IFNRLnNlbGVjdCgpOwoKICAgIGlmIChmaWVsZHMpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzcWwuZmllbGQoZmllbGRzW2ldKTsKICAgICAgfQogICAgfQoKICAgIHZhciB0YWJsZU5hbWU7CgogICAgZm9yICh2YXIgcHJvcE5hbWUgaW4gcXVlcnkpIHsKICAgICAgdmFyIHByb3BWYWx1ZSA9IHF1ZXJ5W3Byb3BOYW1lXTsKCiAgICAgIGlmIChwcm9wTmFtZSA9PSAndHlwZScpIHsKICAgICAgICBzcWwuZnJvbShwcm9wVmFsdWUpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0eXBlb2YgcHJvcFZhbHVlLmJ1aWxkV2hlcmUgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIHNxbCA9IHByb3BWYWx1ZS5idWlsZFdoZXJlKHNxbCwgcHJvcE5hbWUsIHByb3BWYWx1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNxbCA9IHRoaXMuYnVpbGRXaGVyZV8oc3FsLCBwcm9wTmFtZSwgcHJvcFZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gc3FsLnRvU3RyaW5nKCk7CiAgfTsKCiAgdGhpcy5idWlsZERlbGV0ZSA9IGZ1bmN0aW9uIChxdWVyeSkgewogICAgdmFyIHNxbCA9IFNRLnJlbW92ZSgpOwogICAgdmFyIHRhYmxlTmFtZTsKCiAgICBmb3IgKHZhciBwcm9wTmFtZSBpbiBxdWVyeSkgewogICAgICB2YXIgcHJvcFZhbHVlID0gcXVlcnlbcHJvcE5hbWVdOwoKICAgICAgaWYgKHByb3BOYW1lID09ICd0eXBlJykgewogICAgICAgIHNxbC5mcm9tKHByb3BWYWx1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3FsID0gdGhpcy5idWlsZFdoZXJlXyhzcWwsIHByb3BOYW1lLCBwcm9wVmFsdWUpOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHNxbC50b1N0cmluZygpOwogIH07CgogIHRoaXMuYnVpbGRVcGRhdGUgPSBmdW5jdGlvbiAocXVlcnksIGlkQ29sdW1uKSB7CiAgICB2YXIgc3FsID0gU1EudXBkYXRlKCk7CiAgICB2YXIgdGFibGVOYW1lOwoKICAgIGZvciAodmFyIHByb3BOYW1lIGluIHF1ZXJ5KSB7CiAgICAgIHZhciBwcm9wVmFsdWUgPSBxdWVyeVtwcm9wTmFtZV07CgogICAgICBpZiAocHJvcE5hbWUgPT0gJ3R5cGUnKSB7CiAgICAgICAgc3FsLnRhYmxlKHByb3BWYWx1ZSk7CiAgICAgIH0gZWxzZSBpZiAocHJvcE5hbWUgPT0gaWRDb2x1bW4pIHsKICAgICAgICB2YXIgY29sTmFtZSA9IHByb3BOYW1lOwogICAgICAgIHZhciBjb2xWYWx1ZSA9IHF1ZXJ5W2NvbE5hbWVdOwogICAgICAgIHNxbCA9IHRoaXMuYnVpbGRXaGVyZV8oc3FsLCBjb2xOYW1lLCBjb2xWYWx1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3FsID0gdGhpcy5idWlsZFNldF8oc3FsLCBwcm9wTmFtZSwgcHJvcFZhbHVlKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBzcWwudG9TdHJpbmcoKTsKICB9OwoKICB0aGlzLmJ1aWxkSW5zZXJ0ID0gZnVuY3Rpb24gKHF1ZXJ5KSB7CiAgICB2YXIgc3FsID0gU1EuaW5zZXJ0KCk7CiAgICB2YXIgdGFibGVOYW1lOwoKICAgIGZvciAodmFyIHByb3BOYW1lIGluIHF1ZXJ5KSB7CiAgICAgIHZhciBwcm9wVmFsdWUgPSBxdWVyeVtwcm9wTmFtZV07CgogICAgICBpZiAocHJvcE5hbWUgPT0gJ3R5cGUnKSB7CiAgICAgICAgc3FsLmludG8ocHJvcFZhbHVlKTsKICAgICAgfSBlbHNlIGlmIChwcm9wTmFtZS5pbmRleE9mKCdfdHNfJykgIT0gLTEpIHt9IGVsc2UgewogICAgICAgIHNxbCA9IHRoaXMuYnVpbGRTZXRfKHNxbCwgcHJvcE5hbWUsIHByb3BWYWx1ZSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gc3FsLnRvU3RyaW5nKCk7CiAgfTsKCiAgdGhpcy5idWlsZFdoZXJlXyA9IGZ1bmN0aW9uIChzcWwsIHByb3BOYW1lLCBwcm9wVmFsdWUpIHsKICAgIHZhciB0eXBlID0gX3R5cGVvZihwcm9wVmFsdWUpOwoKICAgIGlmICh0eXBlID09ICdzdHJpbmcnKSB7CiAgICAgIHNxbC53aGVyZShwcm9wTmFtZSArICIgPSAnIiArIHByb3BWYWx1ZS5yZXBsYWNlKC8nL2csICInJyIpICsgIiciKTsKICAgIH0gZWxzZSBpZiAodHlwZSA9PSAnbnVtYmVyJykgewogICAgICBzcWwud2hlcmUocHJvcE5hbWUgKyAnID0gJyArIHByb3BWYWx1ZSArICcnKTsKICAgIH0gZWxzZSBpZiAodHlwZSA9PSAnYm9vbGVhbicpIHsKICAgICAgdmFyIGJvb2wgPSBwcm9wVmFsdWUgPT0gdHJ1ZSA/IDEgOiAwOwogICAgICBzcWwud2hlcmUocHJvcE5hbWUgKyAiID0gJyIgKyBib29sICsgIiciKTsKICAgIH0KCiAgICByZXR1cm4gc3FsOwogIH07CgogIHRoaXMuYnVpbGRTZXRfID0gZnVuY3Rpb24gKHNxbCwgcHJvcE5hbWUsIHByb3BWYWx1ZSkgewogICAgdmFyIHR5cGUgPSBfdHlwZW9mKHByb3BWYWx1ZSk7CgogICAgaWYgKHByb3BWYWx1ZSA9PT0gJycpIHByb3BWYWx1ZSA9IG51bGw7CiAgICB2YXIgc2V0VmFsdWU7CgogICAgaWYgKHR5cGUgPT0gJ3N0cmluZycgJiYgcHJvcFZhbHVlKSB7CiAgICAgIHNldFZhbHVlID0gcHJvcFZhbHVlLnJlcGxhY2UoLycvZywgIicnIik7CiAgICB9IGVsc2UgewogICAgICBzZXRWYWx1ZSA9IHByb3BWYWx1ZTsKICAgIH0KCiAgICBpZiAodHlwZSAhPSAndW5kZWZpbmVkJykgc3FsLnNldChwcm9wTmFtZSwgc2V0VmFsdWUpOwogICAgcmV0dXJuIHNxbDsKICB9OwoKICB0aGlzLmNsb3NlID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuY29ubikgewogICAgICBpZiAoIXRoaXMuYXV0b0NvbW1pdCkgewogICAgICAgIHRoaXMuY29ubi5jb21taXQoKTsKICAgICAgfQoKICAgICAgdGhpcy5jb25uLmNsb3NlKCk7CiAgICAgIHRoaXMuY29ubiA9IG51bGw7CiAgICB9CiAgfTsKCiAgdGhpcy5yb2xsYmFjayA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLmNvbm4pIHsKICAgICAgaWYgKCF0aGlzLmF1dG9Db21taXQpIHsKICAgICAgICB0aGlzLmNvbm4ucm9sbGJhY2soKTsKICAgICAgfQoKICAgICAgdGhpcy5jb25uLmNsb3NlKCk7CiAgICAgIHRoaXMuY29ubiA9IG51bGw7CiAgICB9CiAgfTsKCiAgdGhpcy5nZXRNZXRhRGF0YSA9IGZ1bmN0aW9uIChzcWwpIHsKICAgIHZhciBzdG10X3RvdGFsID0gdGhpcy5jb25uLmNyZWF0ZVN0YXRlbWVudCgpOwoKICAgIHRyeSB7CiAgICAgIHZhciByZXN1bHQgPSBzdG10X3RvdGFsLmV4ZWN1dGVRdWVyeShzcWwpOwogICAgICB2YXIgbWV0YSA9IHJlc3VsdC5nZXRNZXRhRGF0YSgpOwogICAgICB2YXIgbWV0YWRhdGEgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDw9IG1ldGEuZ2V0Q29sdW1uQ291bnQoKTsgaSsrKSB7CiAgICAgICAgbWV0YWRhdGEucHVzaCh7CiAgICAgICAgICBjb2x1bW5OYW1lOiBtZXRhLmdldENvbHVtbkxhYmVsKGkpLAogICAgICAgICAgY29sdW1uVHlwZTogbWV0YS5nZXRDb2x1bW5UeXBlKGkpLAogICAgICAgICAgY29sdW1uVHlwZU5hbWU6IG1ldGEuZ2V0Q29sdW1uVHlwZU5hbWUoaSksCiAgICAgICAgICBudWxsYWJsZTogbWV0YS5pc051bGxhYmxlKGkpLAogICAgICAgICAgcHJlY2lzaW9uOiBtZXRhLmdldFByZWNpc2lvbihpKSwKICAgICAgICAgIHNjYWxlOiBtZXRhLmdldFNjYWxlKGkpCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHN0bXRfdG90YWwuY2xvc2UoKTsKICAgICAgcmV0dXJuIG1ldGFkYXRhOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgc3RtdF90b3RhbC5jbG9zZSgpOwogICAgICB0aGlzLmNvbm4uY2xvc2UoKTsKICAgICAgdGhpcy5kZWJ1ZyhlcnJvci5tZXNzYWdlKTsKICAgICAgdGhyb3cgZXJyb3I7CiAgICB9CiAgfTsKCiAgdGhpcy5leGVjUXVlcnkgPSBmdW5jdGlvbiAoc3FsKSB7CiAgICBpZiAoIXRoaXMuZGVidWdVcGRhdGVPbmx5KSB0aGlzLmRlYnVnKHNxbCk7CiAgICB2YXIgcmVzdWx0cyA9IHRoaXMuZXhlY1F1ZXJ5XyhzcWwpOwoKICAgIGlmICh0aGlzLmF1dG9Db21taXQpIHsKICAgICAgdGhpcy5jb25uLmNsb3NlKCk7CiAgICAgIHRoaXMuY29ubiA9IG51bGw7CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgdGhpcy5leGVjUXVlcnlfID0gZnVuY3Rpb24gKHNxbCkgewogICAgdmFyIHN0bXRfdG90YWwgPSB0aGlzLmNvbm4uY3JlYXRlU3RhdGVtZW50KCk7CgogICAgdHJ5IHsKICAgICAgdmFyIHJlc3VsdCA9IHN0bXRfdG90YWwuZXhlY3V0ZVF1ZXJ5KHNxbCk7CiAgICAgIHZhciBtZXRhID0gcmVzdWx0LmdldE1ldGFEYXRhKCk7CiAgICAgIHZhciBoZWFkZXJzID0gW107CgogICAgICBmb3IgKHZhciBpID0gMTsgaSA8PSBtZXRhLmdldENvbHVtbkNvdW50KCk7IGkrKykgewogICAgICAgIGhlYWRlcnMucHVzaChtZXRhLmdldENvbHVtbkxhYmVsKGkpKTsKICAgICAgfQoKICAgICAgdmFyIHJlc3VsdHMgPSBbXTsKCiAgICAgIHdoaWxlIChyZXN1bHQubmV4dCgpKSB7CiAgICAgICAgdmFyIG9iaiA9IHt9OwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhlYWRlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBjb2x1bW5UeXBlID0gbWV0YS5nZXRDb2x1bW5UeXBlKGkgKyAxKTsKCiAgICAgICAgICBpZiAoY29sdW1uVHlwZSA9PSAtNikgewogICAgICAgICAgICBvYmpbaGVhZGVyc1tpXV0gPSByZXN1bHQuZ2V0Qm9vbGVhbihpICsgMSkgfHwgZmFsc2U7CiAgICAgICAgICB9IGVsc2UgaWYgKGNvbHVtblR5cGUgPD0gNSAmJiBjb2x1bW5UeXBlID49IDQpIHsKICAgICAgICAgICAgdmFyIHZhbCA9IHJlc3VsdC5nZXRPYmplY3QoaSArIDEpOwogICAgICAgICAgICBvYmpbaGVhZGVyc1tpXV0gPSB2YWwgPT09IG51bGwgPyAnJyA6IHZhbDsKICAgICAgICAgIH0gZWxzZSBpZiAoY29sdW1uVHlwZSA8PSA4ICYmIGNvbHVtblR5cGUgPj0gNikgewogICAgICAgICAgICB2YXIgdmFsID0gcmVzdWx0LmdldE9iamVjdChpICsgMSk7CiAgICAgICAgICAgIG9ialtoZWFkZXJzW2ldXSA9IHZhbCA9PT0gbnVsbCA/ICcnIDogdmFsOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgb2JqW2hlYWRlcnNbaV1dID0gcmVzdWx0LmdldFN0cmluZyhpICsgMSkgPT0gbnVsbCA/ICcnIDogcmVzdWx0LmdldFN0cmluZyhpICsgMSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXN1bHRzLnB1c2gob2JqKTsKICAgICAgfQoKICAgICAgc3RtdF90b3RhbC5jbG9zZSgpOwogICAgICByZXR1cm4gcmVzdWx0czsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIHN0bXRfdG90YWwuY2xvc2UoKTsKICAgICAgdGhpcy5jb25uLmNsb3NlKCk7CiAgICAgIHRoaXMuZGVidWcoZXJyb3IubWVzc2FnZSk7CiAgICAgIHRocm93IGVycm9yOwogICAgfQogIH07CgogIHRoaXMuZXhlY1VwZGF0ZSA9IGZ1bmN0aW9uIChzcWwpIHsKICAgIHRoaXMuZGVidWcoc3FsKTsKCiAgICBpZiAodGhpcy5ub25FeGVjdXRlKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB0cnkgewogICAgICB2YXIgc3RtdCA9IHRoaXMuY29ubi5wcmVwYXJlU3RhdGVtZW50KHNxbCk7CiAgICAgIHN0bXQuYWRkQmF0Y2goKTsKICAgICAgdmFyIHJlcyA9IHN0bXQuZXhlY3V0ZUJhdGNoKCk7CiAgICAgIHN0bXQuY2xvc2UoKTsKCiAgICAgIGlmICh0aGlzLmF1dG9Db21taXQpIHsKICAgICAgICB0aGlzLmNsb3NlKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXNbMF07CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICB0aGlzLmRlYnVnKGVycm9yLm1lc3NhZ2UpOwogICAgICB0aGlzLmNvbm4uY2xvc2UoKTsKICAgICAgdGhyb3cgZXJyb3I7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gY2hlY2tOb1R5cGVFcnJvcih0eXBlKSB7CiAgICBpZiAodHlwZW9mIHR5cGUgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcign44OG44O844OW44Or5ZCN44KSdHlwZeODl+ODreODkeODhuOCo+OBp+aMh+WumuOBl+OBpuOBj+OBoOOBleOBhO+8mnR5cGUnKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdlblVVSUQoKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICB2YXIgUzQgPSBmdW5jdGlvbiBTNCgpIHsKICAgICAgICByZXR1cm4gKCgxICsgTWF0aC5yYW5kb20oKSkgKiAweDEwMDAwIHwgMCkudG9TdHJpbmcoMTYpLnN1YnN0cmluZygxKTsKICAgICAgfTsKCiAgICAgIHJldHVybiBTNCgpICsgUzQoKSArICdfJyArIFM0KCkgKyAnXycgKyBTNCgpICsgJ18nICsgUzQoKSArICdfJyArIFM0KCkgKyBTNCgpICsgUzQoKTsKICAgIH0oKTsKICB9Cn0KCmZ1bmN0aW9uIFJEYlJlc3VsdChpdGVtcykgewogIHRoaXMuZGJSZXN1bHQgPSBpdGVtczsKICB0aGlzLnJlc3VsdExlbmd0aCA9IGl0ZW1zLmxlbmd0aDsKICB0aGlzLmN1cnJlbnRJbmRleCA9IDA7CiAgdGhpcy5zdGFydEF0SW5kZXggPSAwOyAvLyBoYXNOZXh05LqS5o+b44Oh44K944OD44OJ44CCCgogIHRoaXMuaGFzTmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLmRiUmVzdWx0Lmxlbmd0aCA+IDAgJiYgdGhpcy5jdXJyZW50SW5kZXggPCB0aGlzLnJlc3VsdExlbmd0aDsKICB9OyAvLyBuZXh05LqS5o+b44Oh44K944OD44OJ44CCCgoKICB0aGlzLm5leHQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5kYlJlc3VsdFt0aGlzLmN1cnJlbnRJbmRleCsrXTsKICB9OyAvLyBzb3J0QnnkupLmj5vjg6Hjgr3jg4Pjg4njgIIKCgogIHRoaXMuc29ydEJ5ID0gZnVuY3Rpb24gKGZpZWxkUGF0aCwgZGlyZWN0aW9uKSB7CiAgICB2YXIgb2JqID0gdGhpcy5kYlJlc3VsdFt0aGlzLmN1cnJlbnRJbmRleF07CiAgICBpZiAodHlwZW9mIG9iaiA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiB0aGlzOwogICAgaWYgKHR5cGVvZiBvYmpbZmllbGRQYXRoXSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiB0aGlzOwoKICAgIHZhciBhc2NlbmRpbmcgPSBmdW5jdGlvbiBhc2NlbmRpbmcoYSwgYikgewogICAgICB2YXIgYVMgPSBhW2ZpZWxkUGF0aF07CiAgICAgIHZhciBiUyA9IGJbZmllbGRQYXRoXTsKICAgICAgaWYgKGFTIDwgYlMpIHJldHVybiAtMTsKICAgICAgaWYgKGFTID4gYlMpIHJldHVybiAxOwogICAgICByZXR1cm4gMDsKICAgIH07CgogICAgdmFyIGRlc2NlbmRpbmcgPSBmdW5jdGlvbiBkZXNjZW5kaW5nKGEsIGIpIHsKICAgICAgdmFyIGFTID0gYVtmaWVsZFBhdGhdOwogICAgICB2YXIgYlMgPSBiW2ZpZWxkUGF0aF07CiAgICAgIGlmIChhUyA8IGJTKSByZXR1cm4gMTsKICAgICAgaWYgKGFTID4gYlMpIHJldHVybiAtMTsKICAgICAgcmV0dXJuIDA7CiAgICB9OwoKICAgIHZhciBzb3J0ZXIgPSBhc2NlbmRpbmc7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAyICYmIGRpcmVjdGlvbiA9PSAxKSBzb3J0ZXIgPSBkZXNjZW5kaW5nOwogICAgdGhpcy5kYlJlc3VsdC5zb3J0KHNvcnRlcik7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICB0aGlzLmxpbWl0ID0gZnVuY3Rpb24gKG51bWJlcikgewogICAgaWYgKG51bWJlciArIHRoaXMuc3RhcnRBdEluZGV4IDw9IHRoaXMucmVzdWx0TGVuZ3RoKSB7CiAgICAgIHRoaXMucmVzdWx0TGVuZ3RoID0gbnVtYmVyICsgdGhpcy5zdGFydEF0SW5kZXg7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgdGhpcy5zdGFydEF0ID0gZnVuY3Rpb24gKG51bWJlcikgewogICAgdGhpcy5zdGFydEF0SW5kZXggPSBudW1iZXI7CiAgICB0aGlzLmN1cnJlbnRJbmRleCA9IG51bWJlcjsKICAgIHJldHVybiB0aGlzOwogIH07CgogIHJldHVybiB0aGlzOwp9"},{"version":3,"sources":["/Users/hyamakawa/VSCodeWork/Modern-T/Modern-T/study_template/web_application/server/util/EsmRdb.js"],"names":["EsmRdb","RdbInstance","settings","config","ASCENDING","DESCENDING","SQ","registerValueHandler","Date","date","Utilities","formatDate","address","dbAddress","mysqlUser","user","mysqlPwd","pwd","db","instanceUrl","dbUrl","autoCommit","debugSheet","debugSheetId","SpreadsheetApp","openById","getSheetByName","nonExecute","debugUpdateOnly","conn","Jdbc","getCloudSqlConnection","setAutoCommit","debug","str","appendRow","Logger","log","createTableBySheet","sheetId","sheetName","dropTable","copyData","ss","sheet","ddl","range","getDataRange","values","getValues","headers","colDefs","keyCol","i","length","colName","colType","getRange","getNote","push","join","createStatement","execute","e","row","item","type","j","insert","autoId","close","AnyOf","buildWhere","sql","propName","propValue","where","anyOf","Not","value","bool","not","GreaterThanOrEqualTo","greaterThanOrEqualTo","LessThanOrEqualTo","lessThanOrEqualTo","GreaterThan","greaterThan","LessThan","lessThan","Between","value1","value2","between","Contains","hasValue","contains","IsNull","isNull","option","checkNoTypeError","idColumn","genUUID","buildInsert","execUpdate","update","buildUpdate","updateOrInsert","countSql","results","execQuery_","Error","count","save","colValue","uuid","remove","buildDelete","query","fields","buildSelect","execQuery","RDbResult","select","field","tableName","from","buildWhere_","toString","table","buildSet_","into","indexOf","replace","setValue","set","commit","rollback","getMetaData","stmt_total","result","executeQuery","meta","metadata","getColumnCount","columnName","getColumnLabel","columnType","getColumnType","columnTypeName","getColumnTypeName","nullable","isNullable","precision","getPrecision","scale","getScale","error","message","next","obj","getBoolean","val","getObject","getString","stmt","prepareStatement","addBatch","res","executeBatch","S4","Math","random","substring","items","dbResult","resultLength","currentIndex","startAtIndex","hasNext","sortBy","fieldPath","direction","ascending","a","b","aS","bS","descending","sorter","arguments","sort","limit","number","startAt"],"mappings":"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","sourcesContent":["export function EsmRdb () {\n  return new RdbInstance(settings)\n}\n\n// ScriptDbInstanceもどき\nfunction RdbInstance (config) {\n  this.ASCENDING = 0\n  this.DESCENDING = 1\n\n  SQ.registerValueHandler(Date, function (date) {\n    //    return '\"' + date.getFullYear() + '-' + (date.getMonth()+1) + '-' + date.getDate() + '\"';\n    return \"'\" + Utilities.formatDate(date, 'JST', 'yyyy-MM-dd HH:mm:ss') + \"'\"\n  })\n\n  this.address = config.dbAddress || '34.84.254.108'\n  this.mysqlUser = config.user || 'user'\n  this.mysqlPwd = config.pwd || 'hoge99'\n  this.db = config.db || 'bpm'\n  this.instanceUrl = 'jdbc:google:mysql://' + this.address\n  this.dbUrl = this.instanceUrl + '/' + this.db\n  this.autoCommit = (typeof config.autoCommit === 'undefined') ? true : config.autoCommit\n\n  this.debugSheet = config.debugSheetId ? SpreadsheetApp.openById(config.debugSheetId).getSheetByName('debug') : null\n  this.nonExecute = config.nonExecute || false\n  this.debugUpdateOnly = config.debugUpdateOnly || false\n\n  this.conn = Jdbc.getCloudSqlConnection(this.dbUrl, this.mysqlUser, this.mysqlPwd)\n  this.conn.setAutoCommit(this.autoCommit)\n\n  this.debug = function (str) {\n    if (this.debugSheet) {\n      this.debugSheet.appendRow([str + ';'])\n    } else {\n      Logger.log(str)\n    }\n  }\n\n  // autoCommitの設定\n  this.setAutoCommit = (autoCommit) => {\n    this.autoCommit = autoCommit\n    this.conn.setAutoCommit(this.autoCommit)\n  }\n\n  this.createTableBySheet = function (sheetId, sheetName, dropTable, copyData) {\n    this.autoCommit = false\n    this.conn.setAutoCommit(this.autoCommit)\n\n    var ss = SpreadsheetApp.openById(sheetId)\n    var sheet = ss.getSheetByName(sheetName)\n    var ddl = 'CREATE TABLE ' + sheetName + ' ('\n\n    var range = sheet.getDataRange()\n    var values = range.getValues()\n    var headers = values[0] // 先頭がカラム名が前提\n\n    var colDefs = []\n    var keyCol = ''\n    for (var i = 0; i < headers.length; i++) {\n      var colName = headers[i]\n      if (i == 0) keyCol = colName\n      var colType = sheet.getRange(1, (i + 1)).getNote()\n      colDefs.push(colName + ' ' + colType)\n    }\n    ddl += colDefs.join(',')\n    ddl += ',PRIMARY KEY(' + keyCol + ')'\n    ddl += ');'\n    this.debug(ddl)\n\n    try {\n      if (dropTable) {\n        this.conn.createStatement().execute('drop table ' + sheetName)\n      }\n    } catch (e) {\n      this.debug('drop table失敗（無視）')\n    }\n\n    this.conn.createStatement().execute(ddl)\n\n    if (copyData) {\n      for (var i = 1; i < values.length; i++) {\n        var row = values[i]\n        var item = {}\n        item.type = sheetName\n        for (var j = 0; j < row.length; j++) {\n          item[headers[j]] = row[j]\n        }\n        this.debug(item)\n        this.insert(item, { autoId: false })\n      }\n    }\n    this.close()\n  }\n\n  var AnyOf = function (values) {\n    this.values = values\n    this.buildWhere = function (sql, propName, propValue) {\n      sql.where(propName + ' in ?', this.values)\n      return sql\n    }\n  }\n  this.anyOf = function (values) {\n    return new AnyOf(values)\n  }\n  var Not = function (value) {\n    this.value = value\n\n    this.buildWhere = function (sql, propName, propValue) {\n      var type = typeof (this.value)\n      if (type == 'string') {\n        sql.where(propName + \" != '\" + this.value + \"'\")\n      } else if (type == 'number') {\n        sql.where(propName + ' != ' + this.value + '')\n      } else if (type == 'boolean') {\n        var bool = (this.value == true) ? 1 : 0\n        sql.where(propName + \" != '\" + bool + \"'\")\n      }\n      return sql\n    }\n  }\n  this.not = function (value) {\n    return new Not(value)\n  }\n\n  var GreaterThanOrEqualTo = function (value) {\n    this.value = value\n    this.buildWhere = function (sql, propName, propValue) {\n      sql.where(propName + ' >= ?', this.value)\n      return sql\n    }\n  }\n  this.greaterThanOrEqualTo = function (value) {\n    return new GreaterThanOrEqualTo(value)\n  }\n  var LessThanOrEqualTo = function (value) {\n    this.value = value\n    this.buildWhere = function (sql, propName, propValue) {\n      sql.where(propName + ' <= ?', this.value)\n      return sql\n    }\n  }\n  this.lessThanOrEqualTo = function (value) {\n    return new LessThanOrEqualTo(value)\n  }\n  var GreaterThan = function (value) {\n    this.value = value\n    this.buildWhere = function (sql, propName, propValue) {\n      sql.where(propName + ' > ?', this.value)\n      return sql\n    }\n  }\n  this.greaterThan = function (value) {\n    return new GreaterThan(value)\n  }\n  var LessThan = function (value) {\n    this.value = value\n    this.buildWhere = function (sql, propName, propValue) {\n      sql.where(propName + ' < ?', this.value)\n      return sql\n    }\n  }\n  this.lessThan = function (value) {\n    return new LessThan(value)\n  }\n  var Between = function (value1, value2) {\n    this.value1 = value1\n    this.value2 = value2\n    this.buildWhere = function (sql, propName, propValue) {\n      sql.where(propName + ' between ? and ?', this.value1, this.value2)\n      return sql\n    }\n  }\n  this.between = function (value1, value2) {\n    return new Between(value1, value2)\n  }\n  var Contains = function (value) {\n    this.value = value\n    this.hasValue = function () {\n      return this.value != ''\n    }\n    this.buildWhere = function (sql, propName, propValue) {\n      sql.where(propName + \" like '%\" + this.value + \"%'\")\n      return sql\n    }\n  }\n  this.contains = function (value) {\n    return new Contains(value)\n  }\n  var IsNull = function (value) {\n    this.value = value\n    this.buildWhere = function (sql, propName, propValue) {\n      sql.where(propName + ' is NULL')\n      return sql\n    }\n  }\n  this.isNull = function (value) {\n    return new IsNull(value)\n  }\n  // insertメソッド。\n  this.insert = function (item, option) {\n    checkNoTypeError(item.type)\n\n    var idColumn = option.idColumn || '_id_'\n    var autoId = (typeof option.autoId === 'undefined') ? true : option.autoId\n    if (autoId) { // insert auto key\n      item[idColumn] = genUUID()\n    }\n\n    var sql = this.buildInsert(item)\n    this.execUpdate(sql)\n    return item\n  }\n  // updateメソッド。\n  this.update = function (item, option) {\n    checkNoTypeError(item.type)\n\n    var idColumn = '_id_'\n    if (option) {\n      idColumn = option.idColumn\n    }\n\n    var sql = this.buildUpdate(item, idColumn)\n    this.execUpdate(sql)\n    return item\n  }\n  // あればupdate、なければinsert\n  this.updateOrInsert = function (item, option) {\n    checkNoTypeError(item.type)\n    var idColumn = '_id_'\n    if (option) {\n      idColumn = option.idColumn\n    }\n    var countSql = 'select count(*) as count from ' + item.type + ' where ' + idColumn + \" = '\" + item[idColumn] + \"'\"\n    var results = this.execQuery_(countSql)\n    if (results.length === 0) throw new Error('レコードが存在しません。:' + item)\n    var count = results[0].count\n    if (count == 0) {\n      // insert\n      return this.insert(item, option)\n    } else {\n      // update\n      return this.update(item, option)\n    }\n  }\n\n  // save互換メソッド。\n  // 互換性のため、_id_カラムがプライマリーキーとして存在することを前提とする。\n  this.save = function (item) {\n    checkNoTypeError(item.type)\n    var colName = null; var colValue = null\n    for (var propName in item) {\n      if (propName == '_id_') {\n        colName = propName\n        colValue = item[propName]\n      }\n    }\n    if (!colName) { // insertモード\n      colName = '_id_'\n    }\n    var sql\n    var uuid = genUUID()\n    if (!colValue) { // insert auto key\n      item[colName] = uuid\n      sql = this.buildInsert(item)\n    } else {\n      sql = this.buildUpdate(item, '_id_')\n    }\n\n    this.execUpdate(sql)\n    return item\n  }\n  // remove互換メソッド。\n  this.remove = function (item) {\n    checkNoTypeError(item.type)\n\n    var sql = this.buildDelete(item)\n    return this.execUpdate(sql)\n  }\n  // query互換メソッド。\n  this.query = function (query, fields) {\n    checkNoTypeError(query.type)\n\n    var sql = this.buildSelect(query, fields)\n    var results = this.execQuery(sql)\n    return new RDbResult(results)\n  }\n  this.buildSelect = function (query, fields) {\n    var sql = SQ.select()\n    if (fields) {\n      for (var i = 0; i < fields.length; i++) {\n        sql.field(fields[i])\n      }\n    }\n    var tableName\n    for (var propName in query) {\n      var propValue = query[propName]\n      if (propName == 'type') {\n        sql.from(propValue)\n      } else {\n        if (typeof propValue.buildWhere === 'function') {\n          sql = propValue.buildWhere(sql, propName, propValue)\n        } else {\n          sql = this.buildWhere_(sql, propName, propValue)\n        }\n      }\n    }\n    return sql.toString()\n  }\n  this.buildDelete = function (query) {\n    var sql = SQ.remove()\n    var tableName\n    for (var propName in query) {\n      var propValue = query[propName]\n      if (propName == 'type') {\n        sql.from(propValue)\n      } else {\n        sql = this.buildWhere_(sql, propName, propValue)\n      }\n    }\n    return sql.toString()\n  }\n  this.buildUpdate = function (query, idColumn) {\n    var sql = SQ.update()\n    var tableName\n    for (var propName in query) {\n      var propValue = query[propName]\n      if (propName == 'type') {\n        sql.table(propValue)\n      } else if (propName == idColumn) {\n        var colName = propName\n        var colValue = query[colName]\n        sql = this.buildWhere_(sql, colName, colValue)\n      } else {\n        sql = this.buildSet_(sql, propName, propValue)\n      }\n    }\n    return sql.toString()\n  }\n  this.buildInsert = function (query) {\n    var sql = SQ.insert()\n    var tableName\n    for (var propName in query) {\n      var propValue = query[propName]\n      if (propName == 'type') {\n        sql.into(propValue)\n      } else if (propName.indexOf('_ts_') != -1) {\n      } else {\n        sql = this.buildSet_(sql, propName, propValue)\n      }\n    }\n    return sql.toString()\n  }\n\n  this.buildWhere_ = function (sql, propName, propValue) {\n    var type = typeof (propValue)\n    if (type == 'string') {\n      sql.where(propName + \" = '\" + propValue.replace(/'/g, \"''\") + \"'\")\n    } else if (type == 'number') {\n      sql.where(propName + ' = ' + propValue + '')\n    } else if (type == 'boolean') {\n      var bool = (propValue == true) ? 1 : 0\n      sql.where(propName + \" = '\" + bool + \"'\")\n    }\n    return sql\n  }\n  this.buildSet_ = function (sql, propName, propValue) {\n    var type = typeof (propValue)\n    if (propValue === '') propValue = null\n    var setValue\n    if (type == 'string' && propValue) {\n      setValue = propValue.replace(/'/g, \"''\")\n    } else {\n      setValue = propValue\n    }\n    if (type != 'undefined') sql.set(propName, setValue)\n    return sql\n  }\n\n  this.close = function () {\n    if (this.conn) {\n      if (!this.autoCommit) {\n        this.conn.commit()\n      }\n      this.conn.close()\n      this.conn = null\n    }\n  }\n  this.rollback = function () {\n    if (this.conn) {\n      if (!this.autoCommit) {\n        this.conn.rollback()\n      }\n      this.conn.close()\n      this.conn = null\n    }\n  }\n  this.getMetaData = function (sql) {\n    var stmt_total = this.conn.createStatement()\n    try {\n      var result = stmt_total.executeQuery(sql)\n      var meta = result.getMetaData()\n\n      var metadata = []\n      for (var i = 1; i <= meta.getColumnCount(); i++) {\n        metadata.push({ columnName: meta.getColumnLabel(i), columnType: meta.getColumnType(i), columnTypeName: meta.getColumnTypeName(i), nullable: meta.isNullable(i), precision: meta.getPrecision(i), scale: meta.getScale(i) })\n      }\n\n      stmt_total.close()\n      return metadata\n    } catch (error) {\n      stmt_total.close()\n      this.conn.close()\n      this.debug(error.message)\n      throw error\n    }\n  }\n\n  this.execQuery = function (sql) {\n    if (!this.debugUpdateOnly) this.debug(sql)\n    var results = this.execQuery_(sql)\n    if (this.autoCommit) {\n      this.conn.close()\n      this.conn = null\n    }\n    return results\n  }\n  this.execQuery_ = function (sql) {\n    var stmt_total = this.conn.createStatement()\n    try {\n      var result = stmt_total.executeQuery(sql)\n      var meta = result.getMetaData()\n\n      var headers = []\n      for (var i = 1; i <= meta.getColumnCount(); i++) {\n        headers.push(meta.getColumnLabel(i))\n      }\n      var results = []\n      while (result.next()) {\n        var obj = {}\n        for (var i = 0; i < headers.length; i++) {\n          var columnType = meta.getColumnType(i + 1)\n          if (columnType == -6) {\n            obj[headers[i]] = result.getBoolean(i + 1) || false\n          } else if (columnType <= 5 && columnType >= 4) {\n            var val = result.getObject(i + 1)\n            obj[headers[i]] = (val === null ? '' : val)\n          } else if (columnType <= 8 && columnType >= 6) {\n            var val = result.getObject(i + 1)\n            obj[headers[i]] = (val === null ? '' : val)\n          } else {\n            obj[headers[i]] = (result.getString(i + 1) == null ? '' : result.getString(i + 1))\n          }\n        }\n        results.push(obj)\n      }\n      stmt_total.close()\n      return results\n    } catch (error) {\n      stmt_total.close()\n      this.conn.close()\n      this.debug(error.message)\n      throw error\n    }\n  }\n  this.execUpdate = function (sql) {\n    this.debug(sql)\n    if (this.nonExecute) {\n      return\n    }\n    try {\n      var stmt = this.conn.prepareStatement(sql)\n      stmt.addBatch()\n      var res = stmt.executeBatch()\n      stmt.close()\n      if (this.autoCommit) {\n        this.close()\n      }\n      return res[0]\n    } catch (error) {\n      this.debug(error.message)\n      this.conn.close()\n      throw error\n    }\n  }\n\n  function checkNoTypeError (type) {\n    if (typeof (type) === 'undefined') {\n      throw new Error('テーブル名をtypeプロパティで指定してください：type')\n    }\n  }\n  function genUUID () {\n    return (function () {\n      var S4 = function () {\n        return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1)\n      }\n      return (S4() + S4() + '_' + S4() + '_' + S4() + '_' + S4() + '_' + S4() + S4() + S4())\n    })()\n  }\n}\n\nfunction RDbResult (items) {\n  this.dbResult = items\n  this.resultLength = items.length\n  this.currentIndex = 0\n  this.startAtIndex = 0\n\n  // hasNext互換メソッド。\n  this.hasNext = function () {\n    return (this.dbResult.length > 0 && this.currentIndex < this.resultLength)\n  }\n  // next互換メソッド。\n  this.next = function () {\n    return this.dbResult[this.currentIndex++]\n  }\n\n  // sortBy互換メソッド。\n  this.sortBy = function (fieldPath, direction) {\n    var obj = this.dbResult[this.currentIndex]\n    if (typeof obj === 'undefined') return this\n    if (typeof obj[fieldPath] === 'undefined') return this\n\n    var ascending = function (a, b) {\n      var aS = a[fieldPath]\n      var bS = b[fieldPath]\n      if (aS < bS) return -1\n      if (aS > bS) return 1\n      return 0\n    }\n    var descending = function (a, b) {\n      var aS = a[fieldPath]\n      var bS = b[fieldPath]\n      if (aS < bS) return 1\n      if (aS > bS) return -1\n      return 0\n    }\n\n    var sorter = ascending\n    if (arguments.length == 2 && direction == 1) sorter = descending\n    this.dbResult.sort(sorter)\n\n    return this\n  }\n\n  this.limit = function (number) {\n    if (number + this.startAtIndex <= this.resultLength) {\n      this.resultLength = (number + this.startAtIndex)\n    }\n    return this\n  }\n\n  this.startAt = function (number) {\n    this.startAtIndex = number\n    this.currentIndex = number\n    return this\n  }\n\n  return this\n}\n"]}]}